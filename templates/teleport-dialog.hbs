{{! Basic Information Section }}
<fieldset class="basic-info-section">
  <legend>
    {{localize "EMPUZZLES.BasicInfo"}}
  </legend>

  <div class="form-group">
    <label for="tileName">{{localize "EMPUZZLES.TileName"}}</label>
    <input type="text" name="tileName" value="{{tileName}}" />
    <p class="hint">{{localize "EMPUZZLES.TileNameHint"}}</p>
  </div>

  {{! Creation Type Toggle (Tile vs Region) - only shown if Enhanced Region Behaviors is installed }}
  {{#if hasEnhancedRegionBehaviors}}
  <div class="form-group creation-type-group">
    <label>{{localize "EMPUZZLES.CreationType"}}</label>
    <div class="toggle-group">
      <label class="toggle-option {{#if (eq creationType 'tile')}}active{{/if}}">
        <input type="radio" name="creationType" value="tile" {{#if (eq creationType "tile")}}checked{{/if}} />
        <i class="fa-solid fa-cubes"></i> {{localize "EMPUZZLES.CreateAsTile"}}
      </label>
      <label class="toggle-option {{#if (eq creationType 'region')}}active{{/if}}">
        <input type="radio" name="creationType" value="region" {{#if (eq creationType "region")}}checked{{/if}} />
        <i class="fa-regular fa-game-board"></i> {{localize "EMPUZZLES.CreateAsRegion"}}
      </label>
    </div>
    <p class="hint">{{localize "EMPUZZLES.CreationTypeHint"}}</p>
  </div>

  {{! Region-only: Allow Choice option }}
  <div class="form-group region-only-option">
    <label>
      <input type="checkbox" name="regionAllowChoice" {{#if regionAllowChoice}}checked{{/if}} />
      {{localize "EMPUZZLES.AllowChoice"}}
    </label>
    <p class="hint">{{localize "EMPUZZLES.AllowChoiceHint"}}</p>
  </div>
  {{/if}}

  <div class="form-group tile-only-option">
    <label for="tileImage">{{localize "EMPUZZLES.TileImage"}}</label>
    <div class="form-fields">
      <input type="text" name="tileImage" value="{{tileImage}}" />
      <button type="button" class="file-picker" data-target="tileImage" data-type="imagevideo">
        <i class="gi-load"></i>
      </button>
    </div>
    <p class="hint">{{localize "EMPUZZLES.TileImageHint"}}</p>
  </div>

  <div class="form-group tile-only-option">
    <label>
      <input type="checkbox" name="hidden" {{#if hidden}}checked{{/if}} />
      {{localize "EMPUZZLES.HiddenTile"}}
    </label>
    <p class="hint">{{localize "EMPUZZLES.HiddenTileHint"}}</p>
  </div>

  <div class="form-group">
    <label>
      <input type="checkbox" name="pauseGameOnTrigger" {{#if pauseGameOnTrigger}}checked{{/if}} />
      {{localize "EMPUZZLES.PauseGameOnTrigger"}}
    </label>
    <p class="hint">{{localize "EMPUZZLES.PauseGameOnTriggerHint"}}</p>
  </div>
</fieldset>

{{! Teleport Setup Section }}
<fieldset class="teleport-setup-section">
  <legend>
    {{localize "EMPUZZLES.TeleportSetup"}}
  </legend>

  <div class="form-group">
    <label for="targetScene">{{localize "EMPUZZLES.TargetScene"}}</label>
    <select name="targetScene">
      {{#each scenes as |scene|}}
        <option value="{{scene.id}}" {{#if (eq scene.id ../selectedSceneId)}}selected{{/if}}>
          {{scene.name}}
        </option>
      {{/each}}
    </select>
    <p class="hint">{{localize "EMPUZZLES.TargetSceneHint"}}</p>
  </div>

  <div class="form-group">
    <button type="button" data-action="selectPosition" class="select-position-btn">
      <i class="gi-convergence-target"></i>
      {{localize "EMPUZZLES.SelectPosition"}}
    </button>
    {{#if teleportX}}
      <p class="position-display">
        <strong>{{localize "EMPUZZLES.Destination"}}:</strong>
        X: {{teleportX}}, Y: {{teleportY}}
        {{#if teleportWidth}}
          ({{teleportWidth}} Ã— {{teleportHeight}})
        {{/if}}
        {{#if teleportSceneName}}
          <br><em>Scene: {{teleportSceneName}}</em>
        {{/if}}
      </p>
    {{else}}
      <p class="hint">{{localize "EMPUZZLES.SelectPositionHint"}}</p>
    {{/if}}
  </div>

  {{#if isDifferentScene}}
    <div class="form-group warning-box">
      <p>
        <i class="gi-hazard-sign"></i>
        <strong>{{localize "EMPUZZLES.CrossSceneTeleportWarning"}}</strong>
      </p>
      <p>
        {{localize "EMPUZZLES.CrossSceneTeleportWarningHint"}}
      </p>
    </div>

    <div class="form-group">
      <label>
        <input type="checkbox" name="deleteSourceToken" {{#if deleteSourceToken}}checked{{/if}} />
        {{localize "EMPUZZLES.DeleteSourceToken"}}
      </label>
      <p class="hint">{{localize "EMPUZZLES.DeleteSourceTokenHint"}}</p>
    </div>

    {{#if deleteSourceToken}}
      <div class="form-group danger-box">
        <p>
          <i class="gi-hazard-sign"></i>
          <strong>{{localize "EMPUZZLES.DeleteSourceCombatWarning"}}</strong>
        </p>
        <p>
          {{localize "EMPUZZLES.DeleteSourceCombatWarningHint"}}
        </p>
      </div>
    {{/if}}
  {{/if}}

  <div class="form-group">
    <label>
      <input type="checkbox" name="createReturnTeleport" {{#if createReturnTeleport}}checked{{/if}} />
      {{localize "EMPUZZLES.CreateReturnTeleport"}}
    </label>
    <p class="hint">{{localize "EMPUZZLES.CreateReturnTeleportHint"}}</p>
  </div>

  {{! Return Allow Choice - only shown for regions when return teleport is enabled }}
  {{#if createReturnTeleport}}
  <div class="form-group region-only-option">
    <label>
      <input type="checkbox" name="returnAllowChoice" {{#if returnAllowChoice}}checked{{/if}} />
      {{localize "EMPUZZLES.ReturnAllowChoice"}}
    </label>
    <p class="hint">{{localize "EMPUZZLES.ReturnAllowChoiceHint"}}</p>
  </div>
  {{/if}}

  {{#if hasMonksTokenBar}}
  <div class="tile-only-option">
    <div class="form-group">
      <label>
        <input type="checkbox" name="hasSavingThrow" {{#if hasSavingThrow}}checked{{/if}} />
        {{localize "EMPUZZLES.EnableSavingThrow"}}
      </label>
      <p class="hint">{{localize "EMPUZZLES.SavingThrowHint"}}</p>
    </div>

    {{#if hasSavingThrow}}
      <div class="form-group">
        <label for="savingThrow">{{localize "EMPUZZLES.SavingThrow"}}</label>
        <select name="savingThrow">
          <option value="ability:dex" {{#if (eq savingThrow "ability:dex")}}selected{{/if}}>{{localize "EMPUZZLES.DexteritySave"}}</option>
          <option value="ability:str" {{#if (eq savingThrow "ability:str")}}selected{{/if}}>{{localize "EMPUZZLES.StrengthSave"}}</option>
          <option value="ability:con" {{#if (eq savingThrow "ability:con")}}selected{{/if}}>{{localize "EMPUZZLES.ConstitutionSave"}}</option>
          <option value="ability:int" {{#if (eq savingThrow "ability:int")}}selected{{/if}}>{{localize "EMPUZZLES.IntelligenceSave"}}</option>
          <option value="ability:wis" {{#if (eq savingThrow "ability:wis")}}selected{{/if}}>{{localize "EMPUZZLES.WisdomSave"}}</option>
          <option value="ability:cha" {{#if (eq savingThrow "ability:cha")}}selected{{/if}}>{{localize "EMPUZZLES.CharismaSave"}}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="dc">{{localize "EMPUZZLES.DC"}}</label>
        <input type="number" name="dc" value="{{dc}}" min="1" max="30" />
      </div>

      <div class="form-group">
        <label for="flavorText">{{localize "EMPUZZLES.FlavorText"}}</label>
        <input type="text" name="flavorText" value="{{flavorText}}" />
        <p class="hint">{{localize "EMPUZZLES.FlavorTextHint"}}</p>
      </div>
    {{/if}}
  </div>
  {{else}}
    <div class="form-group tile-only-option" style="background: rgba(255, 152, 0, 0.1); border-left: 4px solid #ff9800; padding: 0.75rem; margin-bottom: 1rem;">
      <p style="margin: 0; color: #ff9800;">
        <i class="gi-info"></i>
        <strong>{{localize "EMPUZZLES.SavingThrowUnavailable"}}</strong>
      </p>
      <p style="margin: 0.5rem 0 0 0; font-size: 0.9em;">
        {{localize "EMPUZZLES.SavingThrowUnavailableHint"}}
      </p>
    </div>
  {{/if}}
</fieldset>

{{! Custom Tags Section - Last section }}
{{> partials/custom-tags-section customTags=customTags}}
