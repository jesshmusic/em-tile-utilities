<form>
  <div class="form-group">
    <label for="tileName">{{localize "EMPUZZLES.TileName"}}</label>
    <input type="text" name="tileName" id="tileName" value="{{tileName}}" required />
    <p class="hint">{{localize "EMPUZZLES.TileNameHint"}}</p>
  </div>

  <div class="form-group">
    <label for="tileImage">{{localize "EMPUZZLES.Image"}}</label>
    <div class="form-fields">
      <input type="text" name="tileImage" id="tileImage" value="{{tileImage}}" placeholder="icons/svg/book.svg" />
      <button type="button" class="file-picker" data-target="tileImage" data-type="imagevideo" title="{{localize 'EMPUZZLES.BrowseFiles'}}">
        <i class="fas fa-file-image"></i>
      </button>
    </div>
    <p class="hint">{{localize "EMPUZZLES.TileImageHint"}}</p>
  </div>

  {{#if hasTilesWithVariables}}
    <div class="form-group">
      <label for="tile-select">{{localize "EMPUZZLES.SelectTileWithVariables"}}</label>
      <select id="tile-select" style="width: 100%;">
        <option value="" disabled {{#unless currentTile}}selected{{/unless}} hidden>{{localize "EMPUZZLES.ChooseTile"}}</option>
        {{#each tilesWithVariables as |tile|}}
          <option value="{{tile.id}}" {{#if (eq ../currentTile.id tile.id)}}selected{{/if}}>{{tile.name}} ({{tile.variables.length}} {{localize "EMPUZZLES.Variables"}})</option>
        {{/each}}
      </select>
      <p class="hint">{{localize "EMPUZZLES.SelectTileWithVariablesHint"}}</p>
    </div>

    {{#if currentTile}}
      <div class="form-group variables-selection">
        <label>{{localize "EMPUZZLES.SelectVariables"}}</label>
        <div class="variables-list">
          {{#each currentTile.variables as |variable|}}
            <div class="variable-row">
              <input
                type="checkbox"
                class="variable-checkbox"
                data-variable-name="{{variable.key}}"
                {{#if variable.checked}}checked{{/if}}
              />
              <label class="variable-label">{{variable.key}}</label>
              <input
                type="text"
                name="expected-{{variable.key}}"
                class="expected-value-input"
                placeholder="{{localize 'EMPUZZLES.ExpectedValue'}}"
                value="{{variable.displayValue}}"
              />
            </div>
          {{/each}}
        </div>
        <button type="button" class="add-variables-btn" data-action="addTile">
          <i class="fas fa-plus"></i> {{localize "EMPUZZLES.AddVariables"}}
        </button>
      </div>
    {{/if}}

    {{#if selectedVariables.length}}
      <div class="form-group">
        <label>{{localize "EMPUZZLES.SelectedVariables"}} ({{selectedVariables.length}})</label>
        <div class="selected-variables-list">
          {{#each selectedVariables as |variable index|}}
            <div class="selected-variable-item">
              <div class="variable-info">
                <strong>{{variable.tileName}}</strong> / <code>{{variable.variableName}}</code>
                <span class="expected-value">= {{variable.expectedValue}}</span>
              </div>
              <button type="button" class="remove-variable" data-action="removeVariable" data-index="{{@index}}" title="{{localize 'EMPUZZLES.Remove'}}">
                <i class="fas fa-times"></i>
              </button>
            </div>
          {{/each}}
        </div>
      </div>

      <div class="form-group flow-section">
        <label>{{localize "EMPUZZLES.CheckFlow"}}</label>
        <p class="hint">{{localize "EMPUZZLES.CheckFlowHint"}}</p>
        <div class="flow-info">
          <i class="fas fa-info-circle"></i>
          <span>{{localize "EMPUZZLES.CheckFlowInfo"}}</span>
        </div>
      </div>
    {{/if}}
  {{else}}
    <div class="form-group">
      <p class="hint" style="color: var(--color-text-dark-warning); font-weight: bold;">
        <i class="fas fa-exclamation-triangle"></i> {{localize "EMPUZZLES.NoTilesWithVariables"}}
      </p>
    </div>
  {{/if}}
</form>
