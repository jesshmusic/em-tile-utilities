<div class="tile-manager-container">
  <div class="tile-manager-header">
    {{#if hasTiles}}
      <div class="tile-count-info">
        <strong>{{localize "EMPUZZLES.TotalTiles"}}:</strong> {{tileCount}}
      </div>
    {{/if}}
    <button type="button" class="refresh-tiles-btn" data-action="refreshTiles" title="{{localize 'EMPUZZLES.Refresh'}}">
      <i class="fas fa-sync"></i> {{localize "EMPUZZLES.Refresh"}}
    </button>
  </div>

  <div class="tile-creation-buttons">
    <button type="button" class="create-tile-btn create-switch-btn" data-action="createSwitch" title="{{localize 'EMPUZZLES.CreateSwitch'}}">
      <i class="gi-lever"></i> {{localize "EMPUZZLES.CreateSwitch"}}
    </button>
    <button type="button" class="create-tile-btn create-light-btn" data-action="createLight" title="{{localize 'EMPUZZLES.CreateLight'}}">
      <i class="gi-candle-flame"></i> {{localize "EMPUZZLES.CreateLight"}}
    </button>
    <button type="button" class="create-tile-btn create-reset-btn" data-action="createReset" title="{{localize 'EMPUZZLES.CreateResetTile'}}">
      <i class="gi-clockwise-rotation"></i> {{localize "EMPUZZLES.CreateResetTile"}}
    </button>
  </div>

  <div class="tile-manager-controls">
    <div class="search-group">
      <div class="search-input-wrapper">
        <input type="text" class="tile-search-input" id="tile-search" value="{{searchQuery}}" placeholder="{{localize 'EMPUZZLES.SearchPlaceholder'}}" />
        <button type="button" class="search-clear-btn" title="{{localize 'EMPUZZLES.ClearSearch'}}" style="{{#if searchQuery}}display: block;{{else}}display: none;{{/if}}">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    <div class="sort-group">
      <label for="tile-sort">{{localize "EMPUZZLES.SortBy"}}:</label>
      <select class="tile-sort-select" id="tile-sort">
        <option value="name" {{#if (eq sortBy "name")}}selected{{/if}}>{{localize "EMPUZZLES.Name"}}</option>
        <option value="x" {{#if (eq sortBy "x")}}selected{{/if}}>{{localize "EMPUZZLES.PositionX"}}</option>
        <option value="y" {{#if (eq sortBy "y")}}selected{{/if}}>{{localize "EMPUZZLES.PositionY"}}</option>
        <option value="elevation" {{#if (eq sortBy "elevation")}}selected{{/if}}>{{localize "EMPUZZLES.Elevation"}}</option>
        <option value="sort" {{#if (eq sortBy "sort")}}selected{{/if}}>{{localize "EMPUZZLES.SortOrder"}}</option>
      </select>
    </div>
  </div>

  {{#if hasTiles}}

    <div class="tile-list-scroll">
      {{#each tiles as |tile|}}
        <div class="tile-entry" data-tile-id="{{tile.id}}">
          <div class="tile-header">
            <div class="tile-info">
              {{#if tile.image}}
                {{#if tile.isVideo}}
                  <video src="{{tile.image}}" class="tile-thumbnail" autoplay loop muted></video>
                {{else}}
                  <img src="{{tile.image}}" class="tile-thumbnail" />
                {{/if}}
              {{else}}
                <img src="icons/svg/hazard.svg" class="tile-thumbnail tile-thumbnail-placeholder" />
              {{/if}}
              <div class="tile-details">
                <strong class="tile-name">{{tile.name}}</strong>
                <div class="tile-meta">
                  <span class="tile-position">{{localize "EMPUZZLES.Position"}}: ({{tile.x}}, {{tile.y}})</span>
                  <span class="tile-size">{{localize "EMPUZZLES.Size"}}: {{tile.width}}x{{tile.height}}</span>
                  <span class="tile-elevation">Elevation: {{tile.elevation}}</span>
                  <span class="tile-sort">Sort: {{tile.sort}}</span>
                </div>
              </div>
            </div>
            <div class="tile-actions">
              <button type="button" class="tile-action-btn toggle-btn {{#unless tile.hidden}}active{{/unless}}" data-action="toggleVisibility" data-tile-id="{{tile.id}}" title="{{localize 'EMPUZZLES.ToggleVisibility'}}">
                {{#if tile.hidden}}
                  <i class="fas fa-eye-slash"></i>
                {{else}}
                  <i class="fas fa-eye"></i>
                {{/if}}
              </button>
              {{#if tile.hasMonksData}}
                <button type="button" class="tile-action-btn toggle-btn {{#if tile.active}}active{{/if}}" data-action="toggleActive" data-tile-id="{{tile.id}}" title="{{localize 'EMPUZZLES.ToggleActive'}}">
                  {{#if tile.active}}
                    <i class="fas fa-check-circle"></i>
                  {{else}}
                    <i class="fas fa-times-circle"></i>
                  {{/if}}
                </button>
              {{/if}}
              <button type="button" class="tile-action-btn" data-action="selectTile" data-tile-id="{{tile.id}}" title="{{localize 'EMPUZZLES.SelectTile'}}">
                <i class="fas fa-crosshairs"></i>
              </button>
              <button type="button" class="tile-action-btn" data-action="editTile" data-tile-id="{{tile.id}}" title="{{localize 'EMPUZZLES.EditTile'}}">
                <i class="fas fa-edit"></i>
              </button>
              <button type="button" class="tile-action-btn delete-btn" data-action="deleteTile" data-tile-id="{{tile.id}}" data-tile-name="{{tile.name}}" title="{{localize 'EMPUZZLES.DeleteTile'}}">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>

          <div class="tile-status">
            {{#if tile.hasMonksData}}
              <span class="status-badge monks-active">
                <i class="fas fa-puzzle-piece"></i> {{localize "EMPUZZLES.MonksActiveTile"}}
              </span>
              {{#if tile.actionCount}}
                <span class="status-badge">
                  <i class="fas fa-bolt"></i> {{tile.actionCount}} {{localize "EMPUZZLES.Actions"}}
                </span>
              {{/if}}
              {{#if tile.variableCount}}
                <span class="status-badge">
                  <i class="fas fa-code"></i> {{tile.variableCount}} {{localize "EMPUZZLES.Variables"}}
                </span>
              {{/if}}
              {{#unless tile.active}}
                <span class="status-badge inactive">
                  <i class="fas fa-pause"></i> {{localize "EMPUZZLES.Inactive"}}
                </span>
              {{/unless}}
            {{/if}}
            {{#if tile.hidden}}
              <span class="status-badge hidden">
                <i class="fas fa-eye-slash"></i> {{localize "EMPUZZLES.Hidden"}}
              </span>
            {{/if}}
            {{#if tile.locked}}
              <span class="status-badge locked">
                <i class="fas fa-lock"></i> {{localize "EMPUZZLES.Locked"}}
              </span>
            {{/if}}
          </div>
        </div>
      {{/each}}
    </div>
  {{else}}
    <p class="no-tiles-message">
      <em>{{localize "EMPUZZLES.NoTilesOnScene"}}</em>
    </p>
  {{/if}}
</div>
