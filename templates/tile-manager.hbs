<div class="tile-manager-container">
  <div class="tile-manager-header">
    {{#if hasTiles}}
      <div class="tile-count-info">
        <strong>{{localize "EMPUZZLES.TotalTiles"}}:</strong> {{tileCount}}
      </div>
    {{/if}}
    <div class="header-actions">
      <button type="button" class="import-tile-btn" data-action="importTile" title="{{localize 'EMPUZZLES.ImportTile'}}">
        <i class="fas fa-file-import"></i> {{localize "EMPUZZLES.ImportTile"}}
      </button>
      <button type="button" class="refresh-tiles-btn" data-action="refreshTiles" title="{{localize 'EMPUZZLES.Refresh'}}">
        <i class="fas fa-sync"></i> {{localize "EMPUZZLES.Refresh"}}
      </button>
      <button type="button" class="view-variables-btn" data-action="viewVariables" title="{{localize 'EMPUZZLES.SceneVariables'}}">
        <i class="gi-scroll-unfurled"></i> {{localize "EMPUZZLES.SceneVariables"}}
      </button>
    </div>
  </div>

  <div class="tile-creation-cards">
    <button type="button" class="create-tile-card create-switch-card" data-action="createSwitch">
      <div class="card-icon">
        <i class="gi-lever"></i>
      </div>
      <div class="card-content">
        <h3 class="card-title">{{localize "EMPUZZLES.CreateSwitch"}}</h3>
        <p class="card-description">{{localize "EMPUZZLES.CreateSwitchDesc"}}</p>
      </div>
    </button>
    <button type="button" class="create-tile-card create-light-card" data-action="createLight">
      <div class="card-icon">
        <i class="gi-candle-flame"></i>
      </div>
      <div class="card-content">
        <h3 class="card-title">{{localize "EMPUZZLES.CreateLight"}}</h3>
        <p class="card-description">{{localize "EMPUZZLES.CreateLightDesc"}}</p>
      </div>
    </button>
    <button type="button" class="create-tile-card create-reset-card" data-action="createReset">
      <div class="card-icon">
        <i class="gi-clockwise-rotation"></i>
      </div>
      <div class="card-content">
        <h3 class="card-title">{{localize "EMPUZZLES.CreateResetTile"}}</h3>
        <p class="card-description">{{localize "EMPUZZLES.CreateResetTileDesc"}}</p>
      </div>
    </button>
    <button type="button" class="create-tile-card create-trap-card" data-action="createDisappearingTrap">
      <div class="card-icon">
        <i class="fa-solid fa-bomb"></i>
      </div>
      <div class="card-content">
        <h3 class="card-title">{{localize "EMPUZZLES.CreateDisappearingTrap"}}</h3>
        <p class="card-description">{{localize "EMPUZZLES.CreateDisappearingTrapDesc"}}</p>
      </div>
    </button>
    <button type="button" class="create-tile-card create-trap-card" data-action="createSwitchingTrap">
      <div class="card-icon">
        <i class="fa-solid fa-skull-crossbones"></i>
      </div>
      <div class="card-content">
        <h3 class="card-title">{{localize "EMPUZZLES.CreateSwitchingTrap"}}</h3>
        <p class="card-description">{{localize "EMPUZZLES.CreateSwitchingTrapDesc"}}</p>
      </div>
    </button>
    <button type="button" class="create-tile-card create-trap-card" data-action="createActivatingTrap">
      <div class="card-icon">
        <i class="fa-solid fa-gears"></i>
      </div>
      <div class="card-content">
        <h3 class="card-title">{{localize "EMPUZZLES.CreateActivatingTrap"}}</h3>
        <p class="card-description">{{localize "EMPUZZLES.CreateActivatingTrapDesc"}}</p>
      </div>
    </button>
    <button type="button" class="create-tile-card create-utility-card" data-action="createCheckVariables">
      <div class="card-icon">
        <i class="fa-solid fa-code-branch"></i>
      </div>
      <div class="card-content">
        <h3 class="card-title">{{localize "EMPUZZLES.CreateCheckVariablesTile"}}</h3>
        <p class="card-description">{{localize "EMPUZZLES.CreateCheckVariablesTileDesc"}}</p>
      </div>
    </button>
  </div>

  <div class="tile-manager-controls">
    <div class="search-group">
      <div class="search-input-wrapper">
        <input type="text" class="tile-search-input" id="tile-search" value="{{searchQuery}}" placeholder="{{localize 'EMPUZZLES.SearchPlaceholder'}}" />
        <button type="button" class="search-clear-btn" title="{{localize 'EMPUZZLES.ClearSearch'}}" style="{{#if searchQuery}}display: block;{{else}}display: none;{{/if}}">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    <div class="sort-group">
      <label for="tile-sort">{{localize "EMPUZZLES.SortBy"}}:</label>
      <select class="tile-sort-select" id="tile-sort">
        <option value="name" {{#if (eq sortBy "name")}}selected{{/if}}>{{localize "EMPUZZLES.Name"}}</option>
        <option value="x" {{#if (eq sortBy "x")}}selected{{/if}}>{{localize "EMPUZZLES.PositionX"}}</option>
        <option value="y" {{#if (eq sortBy "y")}}selected{{/if}}>{{localize "EMPUZZLES.PositionY"}}</option>
        <option value="elevation" {{#if (eq sortBy "elevation")}}selected{{/if}}>{{localize "EMPUZZLES.Elevation"}}</option>
        <option value="sort" {{#if (eq sortBy "sort")}}selected{{/if}}>{{localize "EMPUZZLES.SortOrder"}}</option>
      </select>
    </div>
  </div>

  {{#if hasTiles}}

    <div class="tile-list-scroll">
      {{#each tiles as |tile|}}
        <div class="tile-entry" data-tile-id="{{tile.id}}">
          <div class="tile-header">
            <div class="tile-info">
              {{#if tile.image}}
                {{#if tile.isVideo}}
                  <video src="{{tile.image}}" class="tile-thumbnail" autoplay loop muted></video>
                {{else}}
                  <img src="{{tile.image}}" class="tile-thumbnail" alt="" />
                {{/if}}
              {{else}}
                <img src="icons/svg/hazard.svg" class="tile-thumbnail tile-thumbnail-placeholder" alt="" />
              {{/if}}
              <div class="tile-details">
                <strong class="tile-name">{{tile.name}}</strong>
                <div class="tile-meta">
                  <span class="tile-position">{{localize "EMPUZZLES.Position"}}: ({{tile.x}}, {{tile.y}})</span>
                  <span class="tile-size">{{localize "EMPUZZLES.Size"}}: {{tile.width}}x{{tile.height}}</span>
                  <span class="tile-elevation">Elevation: {{tile.elevation}}</span>
                  <span class="tile-sort">Sort: {{tile.sort}}</span>
                </div>
              </div>
            </div>
            <div class="tile-actions">
              <button type="button" class="tile-action-btn toggle-btn {{#unless tile.hidden}}active{{/unless}}" data-action="toggleVisibility" data-tile-id="{{tile.id}}" title="{{localize 'EMPUZZLES.ToggleVisibility'}}">
                {{#if tile.hidden}}
                  <i class="fas fa-eye-slash"></i>
                {{else}}
                  <i class="fas fa-eye"></i>
                {{/if}}
              </button>
              {{#if tile.hasMonksData}}
                <button type="button" class="tile-action-btn toggle-btn {{#if tile.active}}active{{/if}}" data-action="toggleActive" data-tile-id="{{tile.id}}" title="{{localize 'EMPUZZLES.ToggleActive'}}">
                  {{#if tile.active}}
                    <i class="fas fa-check-circle"></i>
                  {{else}}
                    <i class="fas fa-times-circle"></i>
                  {{/if}}
                </button>
              {{/if}}
              <button type="button" class="tile-action-btn" data-action="selectTile" data-tile-id="{{tile.id}}" title="{{localize 'EMPUZZLES.SelectTile'}}">
                <i class="fas fa-crosshairs"></i>
              </button>
              <button type="button" class="tile-action-btn" data-action="editTile" data-tile-id="{{tile.id}}" title="{{localize 'EMPUZZLES.EditTile'}}">
                <i class="fas fa-edit"></i>
              </button>
              <button type="button" class="tile-action-btn export-btn" data-action="exportTile" data-tile-id="{{tile.id}}" data-tile-name="{{tile.name}}" title="{{localize 'EMPUZZLES.ExportTile'}}">
                <i class="fas fa-file-export"></i>
              </button>
              <button type="button" class="tile-action-btn delete-btn" data-action="deleteTile" data-tile-id="{{tile.id}}" data-tile-name="{{tile.name}}" title="{{localize 'EMPUZZLES.DeleteTile'}}">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>

          {{#if tile.variables.length}}
            <div class="tile-variables">
              {{#each tile.variables as |variable|}}
                <div class="variable-item">
                  <code>{{variable.key}} = {{variable.displayValue}}</code>
                </div>
              {{/each}}
            </div>
          {{/if}}

          <div class="tile-status">
            {{#if tile.hasMonksData}}
              <span class="status-badge monks-active">
                <i class="fas fa-puzzle-piece"></i> {{localize "EMPUZZLES.MonksActiveTile"}}
              </span>
              {{#if tile.actionCount}}
                <span class="status-badge">
                  <i class="fas fa-bolt"></i> {{tile.actionCount}} {{localize "EMPUZZLES.Actions"}}
                </span>
              {{/if}}
              {{#if tile.variableCount}}
                <span class="status-badge">
                  <i class="fas fa-code"></i> {{tile.variableCount}} {{localize "EMPUZZLES.Variables"}}
                </span>
              {{/if}}
              {{#unless tile.active}}
                <span class="status-badge inactive">
                  <i class="fas fa-pause"></i> {{localize "EMPUZZLES.Inactive"}}
                </span>
              {{/unless}}
            {{/if}}
            {{#if tile.hidden}}
              <span class="status-badge hidden">
                <i class="fas fa-eye-slash"></i> {{localize "EMPUZZLES.Hidden"}}
              </span>
            {{/if}}
            {{#if tile.locked}}
              <span class="status-badge locked">
                <i class="fas fa-lock"></i> {{localize "EMPUZZLES.Locked"}}
              </span>
            {{/if}}
          </div>
        </div>
      {{/each}}
    </div>
  {{else}}
    <p class="no-tiles-message">
      <em>{{localize "EMPUZZLES.NoTilesOnScene"}}</em>
    </p>
  {{/if}}
</div>
