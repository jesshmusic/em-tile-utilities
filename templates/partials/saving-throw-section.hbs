{{! Saving Throw Section Partial
  Parameters:
  - hasDefaults: boolean - Whether to use default values from DMG trap
  - canDisable: boolean - Whether fields can be disabled (for DMG traps)
  - showHalfDamage: boolean - Whether to show the half damage checkbox
  - defaultHasSavingThrow: boolean - Default checked state
  - defaultSavingThrow: string - Default saving throw value
  - defaultDC: number - Default DC value
  - defaultHalfDamageOnSuccess: boolean - Default half damage checked state
  - hasDmgTrap: boolean - Whether a DMG trap is selected
  - savingThrowOptions: array - Available saving throw options
  - hasMonksTokenBar: boolean - Whether Monk's Token Bar module is active
}}
{{#if hasMonksTokenBar}}
<div class="form-group">
  <label>
    <input
      type="checkbox"
      id="hasSavingThrow"
      {{#unless (and canDisable hasDmgTrap)}}name="hasSavingThrow"{{/unless}}
      data-saving-throw-checkbox
      {{#if defaultHasSavingThrow}}checked{{/if}}
      {{#if (and canDisable hasDmgTrap)}}disabled{{/if}}
    />
    {{localize "EMPUZZLES.HasSavingThrow"}}
  </label>
  {{! Hidden input to preserve value when checkbox is disabled }}
  {{#if (and canDisable hasDmgTrap defaultHasSavingThrow)}}
    <input type="hidden" name="hasSavingThrow" value="on" />
  {{/if}}
  <p class="hint">{{localize "EMPUZZLES.HasSavingThrowHint"}}</p>
</div>

<div class="saving-throw-fields" style="display: none;">
  <div class="form-group">
    <label for="savingThrow">{{localize "EMPUZZLES.SavingThrow"}}</label>
    <select id="savingThrow" {{#unless (and canDisable hasDmgTrap)}}name="savingThrow"{{/unless}} {{#if (and canDisable hasDmgTrap)}}disabled{{/if}}>
      {{#each savingThrowOptions as |option|}}
        {{#if (and ../hasDefaults ../defaultSavingThrow)}}
          <option value="{{option.value}}" {{#if (eq option.value ../defaultSavingThrow)}}selected{{/if}}>
            {{localize option.label}}
          </option>
        {{else}}
          <option value="{{option.value}}" {{#if (eq option.value "ability:dex")}}selected{{/if}}>
            {{localize option.label}}
          </option>
        {{/if}}
      {{/each}}
    </select>
    {{! Hidden input to preserve value when select is disabled }}
    {{#if (and canDisable hasDmgTrap defaultSavingThrow)}}
      <input type="hidden" name="savingThrow" value="{{defaultSavingThrow}}" />
    {{/if}}
    <p class="hint">{{localize "EMPUZZLES.SavingThrowHint"}}</p>
  </div>

  <div class="form-group">
    <label for="dc">{{localize "EMPUZZLES.DC"}}</label>
    {{#if (and hasDefaults defaultDC)}}
      <input type="number" id="dc" {{#unless (and canDisable hasDmgTrap)}}name="dc"{{/unless}} value="{{defaultDC}}" min="1" max="30" data-dtype="Number" {{#if (and canDisable hasDmgTrap)}}disabled{{/if}} />
      {{! Hidden input to preserve value when input is disabled }}
      {{#if (and canDisable hasDmgTrap)}}
        <input type="hidden" name="dc" value="{{defaultDC}}" />
      {{/if}}
    {{else}}
      <input type="number" id="dc" name="dc" value="14" min="1" max="30" data-dtype="Number" {{#if (and canDisable hasDmgTrap)}}disabled{{/if}} />
    {{/if}}
    <p class="hint">{{localize "EMPUZZLES.DCHint"}}</p>
  </div>

  {{#if showHalfDamage}}
    <div class="form-group">
      <label>
        <input type="checkbox" id="halfDamageOnSuccess" {{#unless (and canDisable hasDmgTrap)}}name="halfDamageOnSuccess"{{/unless}} {{#if defaultHalfDamageOnSuccess}}checked{{/if}} {{#if (and canDisable hasDmgTrap)}}disabled{{/if}} />
        {{localize "EMPUZZLES.HalfDamageOnSuccess"}}
      </label>
      {{! Hidden input to preserve value when checkbox is disabled }}
      {{#if (and canDisable hasDmgTrap defaultHalfDamageOnSuccess)}}
        <input type="hidden" name="halfDamageOnSuccess" value="on" />
      {{/if}}
      <p class="hint">{{localize "EMPUZZLES.HalfDamageOnSuccessHint"}}</p>
    </div>
  {{/if}}
</div>
{{else}}
<div class="form-group" style="background: rgba(255, 152, 0, 0.1); border-left: 4px solid #ff9800; padding: 0.75rem; margin-bottom: 1rem;">
  <p style="margin: 0; color: #ff9800;">
    <i class="fa-solid fa-circle-info"></i>
    <strong>{{localize "EMPUZZLES.SavingThrowUnavailable"}}</strong>
  </p>
  <p style="margin: 0.5rem 0 0 0; font-size: 0.9em;">
    {{localize "EMPUZZLES.SavingThrowUnavailableHint"}}
  </p>
</div>
{{/if}}
